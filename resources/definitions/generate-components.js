const { promisify } = require("util");
const { join } = require("path");
const fs = require("fs");

const writeFile = promisify(fs.writeFile);
const exists = promisify(fs.exists);
const mkdir = promisify(fs.mkdir);

const Folder = join(__dirname, "./discord-components");
// This is actually kinda problematic - There are multiple classes with identical names in the component list, so theres still a few things to add to the discord-components spec
// Generate with: copy(JSON.stringify(Object.entries(tc.webpack.require.c).filter(([_, m]) => m.exports && m.exports.displayName).map(([,m]) => [m.exports.prototype.isPureReactComponent || false, m.exports.displayName])))
let Components = {"Flex":false,"Clickable":false,"Modal":true,"Anchor":false,"ErrorPage":true,"Confirm":true,"FormItem":true,"DownloadApps":false,"Alert":true,"Backdrop":false,"Video":true,"TransitionGroup":false,"FormSection":true,"FormDivider":true,"LazyScroller":false,"Arrow":false,"Caret":false,"Checkbox":true,"Recaptcha":false,"ErrorBoundary":true,"MaskedLink":true,"AsyncComponent":false,"Gift":true,"InvertedGIFLabel":true,"OutdatedClient":true,"MFAConfirm":true,"Camera":true,"Pill":false,"Mention":false,"FormSectionFoldable":true,"MediaHint":false,"NoMic":false,"UninstallConfirmModal":false,"FlyingFocus":false,"ApplicationStoreStandalone":false,"UserContextMenu":true,"ViewsWithMainInterface":true,"MenuItem":false,"MenuGroup":false,"ToggleMenuItem":false,"AnalyticsContext":false,"SwitchItem":true,"SelectTempWrapper":true,"GameIcon":false,"RadioGroup":true,"GuildIcon":true,"SystemMessage":false,"PaymentSourceIcon":true,"FormErrorBlock":true,"DeveloperModeGroup":false,"VoiceUserSummaryItem":true,"StreamerModeEnabled":false,"TextArea":true,"VideoPlayPill":false,"Switch":false,"SelectWithPopout":true,"Slider":true,"Text":false,"ChannelContextMenu":true,"Progress":false,"UploadError":false,"LazyVideo":false,"Breadcrumbs":true,"ChannelMuteItem":false,"MobileIndicator":true,"Protip":true,"BotTag":false,"NativeContextMenu":true,"NativeCopyItem":true,"NativeLinkGroup":true,"SearchWithGoogle":true,"IconButton":true,"Header":false,"GuildContextMenu":true,"PaymentNote":true,"NameTag":true,"SliderMenuItem":false,"AvatarUploader":true,"TileMedia":false,"IntervalWrapper":false,"Sequencer":false,"SettingsNotice":true,"ApplicationSplashBackground":false,"TextAreaAutosize":true,"UserActivity":true,"SpotifyArtists":true,"MessageContent":true,"Autocomplete":true,"NoSearchResults":false,"MasonryKeyboardNavigationWrapper":false,"MasonryList":false,"GIFFavButton":true,"ResponsiveTile":false,"AddressForm":true,"FormRenderer":true,"PremiumModal":false,"HeaderBar":true,"AppSpinner":true,"UserAddFriendItem":false,"BanConfirm":true,"KickConfirm":true,"UserBlockItem":false,"UserCallItem":true,"UserCloseChatItem":true,"UserMentionItem":false,"UserMessageItem":true,"UserNoteItem":false,"Note":false,"CarouselWithSlide":true,"AspectRatioSizer":false,"UserProfileItem":true,"UserRemoveFromGroupItem":false,"UserRingHangItem":false,"UserRolesGroup":false,"UserStreamItem":false,"TransferOwnership":true,"UserVolumeGroup":true,"NativeCutItem":true,"NativePasteItem":true,"NativeSpoilerItem":true,"FileInput":false,"AnimatedCounter":true,"NewsCard":false,"FirstOnDiscordTag":false,"TheGameAwardsTag":false,"CardInfoForm":true,"ChoosePaymentSourceType":true,"Countdown":true,"StoreRecommendationReason":false,"OverlayButton":false,"NavigationBlock":false,"Shaker":false,"PremiumPaymentConfirmation":false,"PremiumPaymentHeader":false,"ActivityFeedCardNews":false,"SlideAnimator":false,"SettingsView":true,"UploadModal":false,"CardMedia":false,"CopyInput":true,"KeybindRecorder":true,"PaymentSourceDropdown":false,"GatedContent":true,"BaseCard":false,"QuickMessage":false,"EveryonePopout":true,"ActivityTimeBar":true,"Markdown":true,"UnloadingWebview":true,"ApplicationStoreLinkItem":true,"ApplicationToggleOverlayItem":true,"ApplicationTogglePrivateItem":true,"UserActivityActions":true,"SpotifyPremiumUpgrade":true,"XboxButton":false,"ActionableError":true,"PopoutList":true,"SelectableItem":true,"BackgroundFlash":false,"MessageEditor":true,"MessagePromoteButton":true,"ChannelTextArea":true,"ChannelTextAreaButton":true,"EmojiButton":true,"ActivityInviteEmbed":true,"MessageAccessories":true,"LazyGIFV":false,"MediaBar":false,"LazyAudio":true,"InviteButton":false,"LazyImageZoomable":true,"ImageModal":true,"ApplicationTile":true,"SystemMessageWrapper":true,"Call":false,"ChannelIconChange":false,"ChannelNameChange":false,"ChannelPinnedMessage":false,"RecipientAdd":false,"RecipientRemove":false,"UserJoin":false,"MessageContextMenu":true,"ImageMenuItem":false,"Report":false,"MessageEditItem":true,"MessageReactionsItem":false,"MessageResendItem":true,"CVCField":true,"CardNumberField":true,"ExpirationDateTextField":true,"StripePaymentRequest":false,"ChannelTextAreaGuard":true,"SearchResultsPopout":true,"EmptyMessage":false,"ApplicationRecommendationActivity":true,"ApplicationNewsItem":true,"ByteProgressSmoother":false,"SearchableQuickSelectWrapper":true,"WebhookModal":true,"UnreadBar":false,"SequencedLottieAnimation":true,"AuthCaptcha":false,"PremiumPaymentModal":true,"PlanSelector":false,"ToggleIcon":true,"CloseIconWithKeybind":false,"List":true,"MessagesPopout":false,"DropdownButton":false,"SettingsInvites":true,"IconSelectOption":true,"GuildRole":true,"PermissionsForm":true,"ButtonGroup":false,"NowPlayingItem":false,"ConfirmChannelDrag":true,"VoiceUser":true,"PasswordConfirm":true,"PhoneVerificationModal":true,"CodeField":true,"PhoneField":true,"PaymentDescription":true,"NotificationSettings":true,"DMVerification":false,"GuildVerification":false,"RecentMentions":false,"CalendarPicker":true,"WelcomeMessage":false,"PoorConnection":true,"VideoBackground":true,"VideoStream":true,"ScreenshareContextMenu":true,"VideoDevicesWarningModal":true,"ChannelCopyTopicItem":true,"ChannelJumpToItem":true,"ChannelMarkReadItem":true,"ChannelToggleVisibilityItem":false,"ApplicationTileFullMedia":false,"PerkTag":false,"ExperimentContainer":false,"HoverCard":false,"DirectoryStoreListing":false,"JSONLD":false,"ApplicationContentRating":true,"ApplicationDescription":true,"ApplicationFeatureFlags":true,"ApplicationLegalInfo":true,"ApplicationStoreListingCarousel":false,"SmallMediaCarousel":true,"ApplicationStoreListingMature":true,"ApplicationStoreCountdown":false,"ReviewScoreCardWrapper":false,"ReviewScoreCard":true,"SystemRequirements":true,"UserListPopout":true,"PrivateChannelsList":false,"ProgressCircle":false,"RTCConnectionStatus":true,"RTCConnectionPopout":true,"ActivityFeedCard":true,"GuildCreateJoinGroup":true,"GuildLeaveGroup":false,"GuildMarkReadItem":false,"GuildMuteItem":false,"GuildNotificationsItem":true,"GuildPrivacySettingsItem":true,"TextEntryConfirm":true,"DeveloperContextMenu":true,"Integration":true,"RegionSelector":true,"ColorPicker":true,"PrefixInput":true,"Webhook":true,"WebhooksIntro":false,"Channels":true,"ChannelCategoryItem":true,"VoiceChannelUserLimit":true,"VoiceUsers":true,"VoiceUserSummary":true,"Guilds":false,"DirectMessage":true,"KeyboardShortcuts":false,"RagingDemon":false,"GiftCodeAcceptModal":true,"PremiumRequiredModal":false,"PurchaseConfirmationModalWrapper":false,"SKUPaymentModal":true,"UpgradeConfirmModal":false,"ActivityInviteModal":true,"ChangeNickname":true,"Invite":true,"QuickSwitcher":true,"QuickSwitcherTutorial":true,"UserProfile":true,"VoiceSettingsModal":true,"FileDownloader":false,"HoverRoll":true,"GrandfatheredWarningModal":false,"MemberListItem":true,"PrivateChannelRecipientsInviteButton":false,"Section":false,"PartyAvatars":false,"Table":true,"TutorialPopout":true,"SlideManager":true,"Grid":true,"VisibilitySensor":false,"GuestLurkerGuard":false,"StatusPickerPopout":true,"UserSettingsCogContextMenu":true,"MFAEnable":true,"QRCode":true,"Paginator":false,"PaymentMethods":true,"UserSettingsConnections":false,"UserSettingsModalDeveloperOptions":true,"DiskSpaceCircle":false,"HypeSquadPerks":false,"FeatureList":false,"PromoVideo":false,"JoinHypeSquadCTA":false,"HouseSelectionModal":false,"HouseSelectionContent":false,"QuestionGroup":false,"UserSettingsHypeSquad":true,"RadioList":true,"PremiumFeatureList":false,"PremiumFeaturesHeader":false,"MechaWumpus":false,"SubscriptionDetails":false,"SubscriptionHeader":false,"CancelConfirmModal":false,"UnclaimedAccountModal":false,"UnverifiedEmailModal":false,"GradientProgress":false,"UserSettingsWindows":true,"AppearanceMessageDisplayMenuItem":false,"AppearanceThemeMenuItem":false,"StreamerModeToggleItem":false,"VoiceSettingsInputModeItem":false,"VoiceSettingsVolumeItem":false,"PlaceholderAvatarWithMessage":false,"ChannelMembersButton":false,"ChannelMuteButton":false,"ChannelPinsButtons":false,"ChannelPins":false,"PrivateChannelRecipients":false,"SearchResults":false,"SearchIndexForeground":false,"JoinCallButton":true,"VideoGrid":true,"VideoTile":true,"QuickSelectWrapper":true,"CardStack":true,"InputAutosize":false,"Friends":false,"AddFriendInput":false,"ListeningAlong":true,"ButtonWithSpinningBorder":true,"DisableSilence":false,"ActivityFeedEmptyState":true,"HorizontalFeedCarousel":true,"VerticalFeedCarousel":true,"ActivityFeedShareModal":true,"PromotionCard":false,"MemberList":true,"NowPlayingPopoutActions":true,"FirstTimeUserCard":false,"GDPRCard":false,"NoGamesCard":false,"NoNewsCard":false,"PlaceholderCard":false,"LaunchableIcon":false,"ApplicationLibraryPage":false,"ApplicationLibraryInventory":true,"GameLibrary":true,"StackedProgress":false,"GameUpdateActivityMonitor":true,"SparkChart":true,"GuildDiscoveryCard":true,"ChannelNotices":false,"GuildMFAWarning":true,"InviteNotice":false,"QuickSwitcherNotice":false,"GuildHeader":true,"AutoAnalytics":false,"IncomingCalls":false,"IncomingCall":false,"Draggable":true,"SidebarNotice":false,"RTCDebugGraph":true,"RTCDebugItem":true,"Verification":true,"PictureInPicture":true,"PictureInPictureVideo":true,"BufferedVideo":true,"UploadArea":false,"Shakeable":false,"Connecting":false,"PremiumExpirationModalWrapper":false,"HomepageNUF":true,"PageClaim":false,"Create":false,"Download":false,"Join":false,"EmailVerificationModal":true,"ConnectedDevice":false,"InteractionRequired":false,"PTTPermission":false,"Suppressed":false,"VADPermission":false,"AddGuildModal":true,"CreateGuildSlide":false,"JoinGuildSlide":false,"ClaimAccount":true,"AccountModal":true,"ClaimAccountModalSuccess":true,"CreateChannelModal":true,"DetectedPlatformAccounts":true,"Login":true,"NewUser":true,"JoinGuildIllustration":true,"NewsEditor":true,"PrivacySettings":true,"PruneGuild":true,"Register":true,"Screenshare":true,"ScreenshareModal":true,"SegmentControl":true,"UserAgreements":true,"NewTermsModal":true}
const Template = `
import { ? } from 'react'

declare class # extends ? {
  static displayName: "#"
}
export = #
`;

exists(Folder)
  .then(yes => (yes ? undefined : mkdir(Folder)))
  .then(() =>
    Promise.all(
      Object.keys(Components).map(displayName =>{
        const File = join(Folder, displayName + ".d.ts")
        return exists(File).then(yes => yes ? undefined : writeFile(
          File,
          Template.replace(/#/g, displayName).replace(
            /\?/g,
            Components[displayName] ? "PureComponent" : "Component"
          )
        ))
      })
    )
  )
  .then(() =>
    writeFile(
      join(Folder, "index.ts"),
      Object.keys(Components).map(
        displayName => `import ${displayName} = require('./${displayName}')`
      ).join("\n") + `\nexport {${Object.keys(Components).join()}}`
    )
  );
